rule win_velso_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-05-16"
        version = "1"
        description = "Detects win.velso."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.velso"
        malpedia_rule_date = "20220513"
        malpedia_hash = "7f4b2229e6ae614d86d74917f6d5b41890e62a26"
        malpedia_version = "20220516"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { ffd0 eb96 8b4c241c c7442430ffffffff e8???????? 8944241c e9???????? }
            // n = 7, score = 200
            //   ffd0                 | call                eax
            //   eb96                 | jmp                 0xffffff98
            //   8b4c241c             | mov                 ecx, dword ptr [esp + 0x1c]
            //   c7442430ffffffff     | mov                 dword ptr [esp + 0x30], 0xffffffff
            //   e8????????           |                     
            //   8944241c             | mov                 dword ptr [esp + 0x1c], eax
            //   e9????????           |                     

        $sequence_1 = { e8???????? 8b742420 b903000000 f3a6 0f841d070000 8b742420 bf???????? }
            // n = 7, score = 200
            //   e8????????           |                     
            //   8b742420             | mov                 esi, dword ptr [esp + 0x20]
            //   b903000000           | mov                 ecx, 3
            //   f3a6                 | repe cmpsb          byte ptr [esi], byte ptr es:[edi]
            //   0f841d070000         | je                  0x723
            //   8b742420             | mov                 esi, dword ptr [esp + 0x20]
            //   bf????????           |                     

        $sequence_2 = { 8b45a4 c6459f00 83c078 894580 31c0 668945b0 8d7600 }
            // n = 7, score = 200
            //   8b45a4               | mov                 eax, dword ptr [ebp - 0x5c]
            //   c6459f00             | mov                 byte ptr [ebp - 0x61], 0
            //   83c078               | add                 eax, 0x78
            //   894580               | mov                 dword ptr [ebp - 0x80], eax
            //   31c0                 | xor                 eax, eax
            //   668945b0             | mov                 word ptr [ebp - 0x50], ax
            //   8d7600               | lea                 esi, [esi]

        $sequence_3 = { 8d842484000000 89442404 893c24 e8???????? 83bc248400000001 89c6 83de00 }
            // n = 7, score = 200
            //   8d842484000000       | lea                 eax, [esp + 0x84]
            //   89442404             | mov                 dword ptr [esp + 4], eax
            //   893c24               | mov                 dword ptr [esp], edi
            //   e8????????           |                     
            //   83bc248400000001     | cmp                 dword ptr [esp + 0x84], 1
            //   89c6                 | mov                 esi, eax
            //   83de00               | sbb                 esi, 0

        $sequence_4 = { 8d4fcf 31d2 83f908 0f8704faffff 8b8c24c0000000 83ef30 897c2430 }
            // n = 7, score = 200
            //   8d4fcf               | lea                 ecx, [edi - 0x31]
            //   31d2                 | xor                 edx, edx
            //   83f908               | cmp                 ecx, 8
            //   0f8704faffff         | ja                  0xfffffa0a
            //   8b8c24c0000000       | mov                 ecx, dword ptr [esp + 0xc0]
            //   83ef30               | sub                 edi, 0x30
            //   897c2430             | mov                 dword ptr [esp + 0x30], edi

        $sequence_5 = { b801000000 31c9 0fb654241c eba1 8b4904 8b542418 89d8 }
            // n = 7, score = 200
            //   b801000000           | mov                 eax, 1
            //   31c9                 | xor                 ecx, ecx
            //   0fb654241c           | movzx               edx, byte ptr [esp + 0x1c]
            //   eba1                 | jmp                 0xffffffa3
            //   8b4904               | mov                 ecx, dword ptr [ecx + 4]
            //   8b542418             | mov                 edx, dword ptr [esp + 0x18]
            //   89d8                 | mov                 eax, ebx

        $sequence_6 = { bb20000000 89d9 29f9 d3fb 895c9014 8b542454 be11000000 }
            // n = 7, score = 200
            //   bb20000000           | mov                 ebx, 0x20
            //   89d9                 | mov                 ecx, ebx
            //   29f9                 | sub                 ecx, edi
            //   d3fb                 | sar                 ebx, cl
            //   895c9014             | mov                 dword ptr [eax + edx*4 + 0x14], ebx
            //   8b542454             | mov                 edx, dword ptr [esp + 0x54]
            //   be11000000           | mov                 esi, 0x11

        $sequence_7 = { 8d0cb1 85c9 0f84f4fcffff c70106000000 895104 e9???????? 89e8 }
            // n = 7, score = 200
            //   8d0cb1               | lea                 ecx, [ecx + esi*4]
            //   85c9                 | test                ecx, ecx
            //   0f84f4fcffff         | je                  0xfffffcfa
            //   c70106000000         | mov                 dword ptr [ecx], 6
            //   895104               | mov                 dword ptr [ecx + 4], edx
            //   e9????????           |                     
            //   89e8                 | mov                 eax, ebp

        $sequence_8 = { c744240cffff0000 89742418 8d75e4 c7442404ffff0000 891c24 89742414 8b4210 }
            // n = 7, score = 200
            //   c744240cffff0000     | mov                 dword ptr [esp + 0xc], 0xffff
            //   89742418             | mov                 dword ptr [esp + 0x18], esi
            //   8d75e4               | lea                 esi, [ebp - 0x1c]
            //   c7442404ffff0000     | mov                 dword ptr [esp + 4], 0xffff
            //   891c24               | mov                 dword ptr [esp], ebx
            //   89742414             | mov                 dword ptr [esp + 0x14], esi
            //   8b4210               | mov                 eax, dword ptr [edx + 0x10]

        $sequence_9 = { c745a801000000 ffd0 8b4d08 c7450cffffffff 85c9 0f84f0fdffff 8b4108 }
            // n = 7, score = 200
            //   c745a801000000       | mov                 dword ptr [ebp - 0x58], 1
            //   ffd0                 | call                eax
            //   8b4d08               | mov                 ecx, dword ptr [ebp + 8]
            //   c7450cffffffff       | mov                 dword ptr [ebp + 0xc], 0xffffffff
            //   85c9                 | test                ecx, ecx
            //   0f84f0fdffff         | je                  0xfffffdf6
            //   8b4108               | mov                 eax, dword ptr [ecx + 8]

    condition:
        7 of them and filesize < 1736704
}