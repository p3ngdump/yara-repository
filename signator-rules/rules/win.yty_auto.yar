rule win_yty_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-05-16"
        version = "1"
        description = "Detects win.yty."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.yty"
        malpedia_rule_date = "20220513"
        malpedia_hash = "7f4b2229e6ae614d86d74917f6d5b41890e62a26"
        malpedia_version = "20220516"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 8b45d8 83e001 0f840c000000 8365d8fe 8b7508 }
            // n = 5, score = 500
            //   8b45d8               | mov                 eax, dword ptr [ebp - 0x28]
            //   83e001               | and                 eax, 1
            //   0f840c000000         | je                  0x12
            //   8365d8fe             | and                 dword ptr [ebp - 0x28], 0xfffffffe
            //   8b7508               | mov                 esi, dword ptr [ebp + 8]

        $sequence_1 = { 64a300000000 8b7508 33ff 897dd8 }
            // n = 4, score = 500
            //   64a300000000         | mov                 dword ptr fs:[0], eax
            //   8b7508               | mov                 esi, dword ptr [ebp + 8]
            //   33ff                 | xor                 edi, edi
            //   897dd8               | mov                 dword ptr [ebp - 0x28], edi

        $sequence_2 = { 8365d8fe 8b7508 e9???????? c3 8b542408 8d420c }
            // n = 6, score = 500
            //   8365d8fe             | and                 dword ptr [ebp - 0x28], 0xfffffffe
            //   8b7508               | mov                 esi, dword ptr [ebp + 8]
            //   e9????????           |                     
            //   c3                   | ret                 
            //   8b542408             | mov                 edx, dword ptr [esp + 8]
            //   8d420c               | lea                 eax, [edx + 0xc]

        $sequence_3 = { 2ad1 8bfe 80ea04 b901000000 e9???????? 8b5508 }
            // n = 6, score = 400
            //   2ad1                 | sub                 dl, cl
            //   8bfe                 | mov                 edi, esi
            //   80ea04               | sub                 dl, 4
            //   b901000000           | mov                 ecx, 1
            //   e9????????           |                     
            //   8b5508               | mov                 edx, dword ptr [ebp + 8]

        $sequence_4 = { 6a00 8d4508 c746140f000000 c7461000000000 50 8bce }
            // n = 6, score = 400
            //   6a00                 | push                0
            //   8d4508               | lea                 eax, [ebp + 8]
            //   c746140f000000       | mov                 dword ptr [esi + 0x14], 0xf
            //   c7461000000000       | mov                 dword ptr [esi + 0x10], 0
            //   50                   | push                eax
            //   8bce                 | mov                 ecx, esi

        $sequence_5 = { 2ad1 80ea13 b902000000 e9???????? }
            // n = 4, score = 400
            //   2ad1                 | sub                 dl, cl
            //   80ea13               | sub                 dl, 0x13
            //   b902000000           | mov                 ecx, 2
            //   e9????????           |                     

        $sequence_6 = { 53 50 e8???????? 83c40c 8d8de8fdffff 51 }
            // n = 6, score = 400
            //   53                   | push                ebx
            //   50                   | push                eax
            //   e8????????           |                     
            //   83c40c               | add                 esp, 0xc
            //   8d8de8fdffff         | lea                 ecx, [ebp - 0x218]
            //   51                   | push                ecx

        $sequence_7 = { 64a300000000 8d8524ffffff 50 e8???????? }
            // n = 4, score = 400
            //   64a300000000         | mov                 dword ptr fs:[0], eax
            //   8d8524ffffff         | lea                 eax, [ebp - 0xdc]
            //   50                   | push                eax
            //   e8????????           |                     

        $sequence_8 = { 8b410c ffd0 8d4f08 51 }
            // n = 4, score = 400
            //   8b410c               | mov                 eax, dword ptr [ecx + 0xc]
            //   ffd0                 | call                eax
            //   8d4f08               | lea                 ecx, [edi + 8]
            //   51                   | push                ecx

        $sequence_9 = { 894608 8945fc 56 c745f001000000 e8???????? 83c404 8bc6 }
            // n = 7, score = 400
            //   894608               | mov                 dword ptr [esi + 8], eax
            //   8945fc               | mov                 dword ptr [ebp - 4], eax
            //   56                   | push                esi
            //   c745f001000000       | mov                 dword ptr [ebp - 0x10], 1
            //   e8????????           |                     
            //   83c404               | add                 esp, 4
            //   8bc6                 | mov                 eax, esi

        $sequence_10 = { 807def00 8b5de8 7503 83cb02 }
            // n = 4, score = 400
            //   807def00             | cmp                 byte ptr [ebp - 0x11], 0
            //   8b5de8               | mov                 ebx, dword ptr [ebp - 0x18]
            //   7503                 | jne                 5
            //   83cb02               | or                  ebx, 2

        $sequence_11 = { 397e14 7204 8b3e eb02 8bfe 8a1402 }
            // n = 6, score = 400
            //   397e14               | cmp                 dword ptr [esi + 0x14], edi
            //   7204                 | jb                  6
            //   8b3e                 | mov                 edi, dword ptr [esi]
            //   eb02                 | jmp                 4
            //   8bfe                 | mov                 edi, esi
            //   8a1402               | mov                 dl, byte ptr [edx + eax]

        $sequence_12 = { 397d1c 7303 8d5508 8b4e10 397e14 7214 }
            // n = 6, score = 400
            //   397d1c               | cmp                 dword ptr [ebp + 0x1c], edi
            //   7303                 | jae                 5
            //   8d5508               | lea                 edx, [ebp + 8]
            //   8b4e10               | mov                 ecx, dword ptr [esi + 0x10]
            //   397e14               | cmp                 dword ptr [esi + 0x14], edi
            //   7214                 | jb                  0x16

        $sequence_13 = { 8b08 8b5108 50 ffd2 ff15???????? 8a857bffffff }
            // n = 6, score = 400
            //   8b08                 | mov                 ecx, dword ptr [eax]
            //   8b5108               | mov                 edx, dword ptr [ecx + 8]
            //   50                   | push                eax
            //   ffd2                 | call                edx
            //   ff15????????         |                     
            //   8a857bffffff         | mov                 al, byte ptr [ebp - 0x85]

        $sequence_14 = { 6a00 8bcf c645fc02 e8???????? 8b0e }
            // n = 5, score = 400
            //   6a00                 | push                0
            //   8bcf                 | mov                 ecx, edi
            //   c645fc02             | mov                 byte ptr [ebp - 4], 2
            //   e8????????           |                     
            //   8b0e                 | mov                 ecx, dword ptr [esi]

        $sequence_15 = { 8975e0 85c9 7407 8b11 8b4204 ffd0 }
            // n = 6, score = 400
            //   8975e0               | mov                 dword ptr [ebp - 0x20], esi
            //   85c9                 | test                ecx, ecx
            //   7407                 | je                  9
            //   8b11                 | mov                 edx, dword ptr [ecx]
            //   8b4204               | mov                 eax, dword ptr [edx + 4]
            //   ffd0                 | call                eax

        $sequence_16 = { 668910 8bc6 5b 8be5 5d c20400 }
            // n = 6, score = 400
            //   668910               | mov                 word ptr [eax], dx
            //   8bc6                 | mov                 eax, esi
            //   5b                   | pop                 ebx
            //   8be5                 | mov                 esp, ebp
            //   5d                   | pop                 ebp
            //   c20400               | ret                 4

        $sequence_17 = { 8d8de8fdffff 51 53 53 6a28 }
            // n = 5, score = 400
            //   8d8de8fdffff         | lea                 ecx, [ebp - 0x218]
            //   51                   | push                ecx
            //   53                   | push                ebx
            //   53                   | push                ebx
            //   6a28                 | push                0x28

        $sequence_18 = { 33c9 33c0 8d7910 85d2 }
            // n = 4, score = 400
            //   33c9                 | xor                 ecx, ecx
            //   33c0                 | xor                 eax, eax
            //   8d7910               | lea                 edi, [ecx + 0x10]
            //   85d2                 | test                edx, edx

        $sequence_19 = { 8a1402 8b3e 2ad1 80ea13 b903000000 eb69 }
            // n = 6, score = 400
            //   8a1402               | mov                 dl, byte ptr [edx + eax]
            //   8b3e                 | mov                 edi, dword ptr [esi]
            //   2ad1                 | sub                 dl, cl
            //   80ea13               | sub                 dl, 0x13
            //   b903000000           | mov                 ecx, 3
            //   eb69                 | jmp                 0x6b

        $sequence_20 = { 57 50 8d45f4 64a300000000 8d8524ffffff }
            // n = 5, score = 400
            //   57                   | push                edi
            //   50                   | push                eax
            //   8d45f4               | lea                 eax, [ebp - 0xc]
            //   64a300000000         | mov                 dword ptr fs:[0], eax
            //   8d8524ffffff         | lea                 eax, [ebp - 0xdc]

        $sequence_21 = { bf10000000 40 3b4610 0f82dbfeffff 397d1c 720c 8b4508 }
            // n = 7, score = 400
            //   bf10000000           | mov                 edi, 0x10
            //   40                   | inc                 eax
            //   3b4610               | cmp                 eax, dword ptr [esi + 0x10]
            //   0f82dbfeffff         | jb                  0xfffffee1
            //   397d1c               | cmp                 dword ptr [ebp + 0x1c], edi
            //   720c                 | jb                  0xe
            //   8b4508               | mov                 eax, dword ptr [ebp + 8]

        $sequence_22 = { 83c404 50 e8???????? 83c418 8b550c }
            // n = 5, score = 300
            //   83c404               | add                 esp, 4
            //   50                   | push                eax
            //   e8????????           |                     
            //   83c418               | add                 esp, 0x18
            //   8b550c               | mov                 edx, dword ptr [ebp + 0xc]

        $sequence_23 = { 833900 7315 e8???????? c70016000000 b816000000 e9???????? 8b550c }
            // n = 7, score = 300
            //   833900               | cmp                 dword ptr [ecx], 0
            //   7315                 | jae                 0x17
            //   e8????????           |                     
            //   c70016000000         | mov                 dword ptr [eax], 0x16
            //   b816000000           | mov                 eax, 0x16
            //   e9????????           |                     
            //   8b550c               | mov                 edx, dword ptr [ebp + 0xc]

        $sequence_24 = { 8b5508 833a00 7d1f 8b4508 }
            // n = 4, score = 300
            //   8b5508               | mov                 edx, dword ptr [ebp + 8]
            //   833a00               | cmp                 dword ptr [edx], 0
            //   7d1f                 | jge                 0x21
            //   8b4508               | mov                 eax, dword ptr [ebp + 8]

        $sequence_25 = { 8b5508 8b4208 99 8bf0 8bfa 6a00 }
            // n = 6, score = 300
            //   8b5508               | mov                 edx, dword ptr [ebp + 8]
            //   8b4208               | mov                 eax, dword ptr [edx + 8]
            //   99                   | cdq                 
            //   8bf0                 | mov                 esi, eax
            //   8bfa                 | mov                 edi, edx
            //   6a00                 | push                0

        $sequence_26 = { 50 e8???????? 8b4d08 894108 8b5508 837a0800 }
            // n = 6, score = 300
            //   50                   | push                eax
            //   e8????????           |                     
            //   8b4d08               | mov                 ecx, dword ptr [ebp + 8]
            //   894108               | mov                 dword ptr [ecx + 8], eax
            //   8b5508               | mov                 edx, dword ptr [ebp + 8]
            //   837a0800             | cmp                 dword ptr [edx + 8], 0

        $sequence_27 = { 034a1c 8b4508 89481c e9???????? }
            // n = 4, score = 300
            //   034a1c               | add                 ecx, dword ptr [edx + 0x1c]
            //   8b4508               | mov                 eax, dword ptr [ebp + 8]
            //   89481c               | mov                 dword ptr [eax + 0x1c], ecx
            //   e9????????           |                     

        $sequence_28 = { 6a24 68ff000000 8b5508 52 }
            // n = 4, score = 300
            //   6a24                 | push                0x24
            //   68ff000000           | push                0xff
            //   8b5508               | mov                 edx, dword ptr [ebp + 8]
            //   52                   | push                edx

        $sequence_29 = { 7d21 8b4508 8b4808 83c118 8b5508 }
            // n = 5, score = 300
            //   7d21                 | jge                 0x23
            //   8b4508               | mov                 eax, dword ptr [ebp + 8]
            //   8b4808               | mov                 ecx, dword ptr [eax + 8]
            //   83c118               | add                 ecx, 0x18
            //   8b5508               | mov                 edx, dword ptr [ebp + 8]

        $sequence_30 = { 8b4c1938 895dd4 85c9 7405 8b01 ff5004 c745fc00000000 }
            // n = 7, score = 200
            //   8b4c1938             | mov                 ecx, dword ptr [ecx + ebx + 0x38]
            //   895dd4               | mov                 dword ptr [ebp - 0x2c], ebx
            //   85c9                 | test                ecx, ecx
            //   7405                 | je                  7
            //   8b01                 | mov                 eax, dword ptr [ecx]
            //   ff5004               | call                dword ptr [eax + 4]
            //   c745fc00000000       | mov                 dword ptr [ebp - 4], 0

        $sequence_31 = { 76da c645f000 c745f400000000 eb26 }
            // n = 4, score = 100
            //   76da                 | jbe                 0xffffffdc
            //   c645f000             | mov                 byte ptr [ebp - 0x10], 0
            //   c745f400000000       | mov                 dword ptr [ebp - 0xc], 0
            //   eb26                 | jmp                 0x28

        $sequence_32 = { 85c0 0f8537050000 8b45d4 83c008 89442404 c70424???????? e8???????? }
            // n = 7, score = 100
            //   85c0                 | test                eax, eax
            //   0f8537050000         | jne                 0x53d
            //   8b45d4               | mov                 eax, dword ptr [ebp - 0x2c]
            //   83c008               | add                 eax, 8
            //   89442404             | mov                 dword ptr [esp + 4], eax
            //   c70424????????       |                     
            //   e8????????           |                     

        $sequence_33 = { 3bc3 7407 50 ff15???????? 899ec0000000 899ec4000000 c786c800000010c94200 }
            // n = 7, score = 100
            //   3bc3                 | cmp                 eax, ebx
            //   7407                 | je                  9
            //   50                   | push                eax
            //   ff15????????         |                     
            //   899ec0000000         | mov                 dword ptr [esi + 0xc0], ebx
            //   899ec4000000         | mov                 dword ptr [esi + 0xc4], ebx
            //   c786c800000010c94200     | mov    dword ptr [esi + 0xc8], 0x42c910

        $sequence_34 = { 64a300000000 8bd1 8b42e8 8d72e8 8b4004 c74410e8d4724300 8b06 }
            // n = 7, score = 100
            //   64a300000000         | mov                 dword ptr fs:[0], eax
            //   8bd1                 | mov                 edx, ecx
            //   8b42e8               | mov                 eax, dword ptr [edx - 0x18]
            //   8d72e8               | lea                 esi, [edx - 0x18]
            //   8b4004               | mov                 eax, dword ptr [eax + 4]
            //   c74410e8d4724300     | mov                 dword ptr [eax + edx - 0x18], 0x4372d4
            //   8b06                 | mov                 eax, dword ptr [esi]

        $sequence_35 = { eb6b 56 6a36 e8???????? 56 e8???????? }
            // n = 6, score = 100
            //   eb6b                 | jmp                 0x6d
            //   56                   | push                esi
            //   6a36                 | push                0x36
            //   e8????????           |                     
            //   56                   | push                esi
            //   e8????????           |                     

        $sequence_36 = { 8bd1 c1fa05 c1e006 030495a0244300 eb05 b8???????? f6400420 }
            // n = 7, score = 100
            //   8bd1                 | mov                 edx, ecx
            //   c1fa05               | sar                 edx, 5
            //   c1e006               | shl                 eax, 6
            //   030495a0244300       | add                 eax, dword ptr [edx*4 + 0x4324a0]
            //   eb05                 | jmp                 7
            //   b8????????           |                     
            //   f6400420             | test                byte ptr [eax + 4], 0x20

        $sequence_37 = { c745ac44000000 6a10 6a00 8d4594 50 e8???????? }
            // n = 6, score = 100
            //   c745ac44000000       | mov                 dword ptr [ebp - 0x54], 0x44
            //   6a10                 | push                0x10
            //   6a00                 | push                0
            //   8d4594               | lea                 eax, [ebp - 0x6c]
            //   50                   | push                eax
            //   e8????????           |                     

        $sequence_38 = { e8???????? 8d8de4bbf0ff 0f1000 0f1105???????? f30f7e4010 660fd605???????? e8???????? }
            // n = 7, score = 100
            //   e8????????           |                     
            //   8d8de4bbf0ff         | lea                 ecx, [ebp - 0xf441c]
            //   0f1000               | movups              xmm0, xmmword ptr [eax]
            //   0f1105????????       |                     
            //   f30f7e4010           | movq                xmm0, qword ptr [eax + 0x10]
            //   660fd605????????     |                     
            //   e8????????           |                     

        $sequence_39 = { c745f32e747874 c645f700 c7458b00000000 8d458f b960000000 }
            // n = 5, score = 100
            //   c745f32e747874       | mov                 dword ptr [ebp - 0xd], 0x7478742e
            //   c645f700             | mov                 byte ptr [ebp - 9], 0
            //   c7458b00000000       | mov                 dword ptr [ebp - 0x75], 0
            //   8d458f               | lea                 eax, [ebp - 0x71]
            //   b960000000           | mov                 ecx, 0x60

        $sequence_40 = { 03cf 83ff1f 0f87a4030000 ff24bda7714200 8bc6 }
            // n = 5, score = 100
            //   03cf                 | add                 ecx, edi
            //   83ff1f               | cmp                 edi, 0x1f
            //   0f87a4030000         | ja                  0x3aa
            //   ff24bda7714200       | jmp                 dword ptr [edi*4 + 0x4271a7]
            //   8bc6                 | mov                 eax, esi

        $sequence_41 = { 0fb60c8576ff4200 0fb6348577ff4200 8bf9 8985b4f8ffff }
            // n = 4, score = 100
            //   0fb60c8576ff4200     | movzx               ecx, byte ptr [eax*4 + 0x42ff76]
            //   0fb6348577ff4200     | movzx               esi, byte ptr [eax*4 + 0x42ff77]
            //   8bf9                 | mov                 edi, ecx
            //   8985b4f8ffff         | mov                 dword ptr [ebp - 0x74c], eax

        $sequence_42 = { c1e106 8b0485a0244300 c644080401 57 e8???????? }
            // n = 5, score = 100
            //   c1e106               | shl                 ecx, 6
            //   8b0485a0244300       | mov                 eax, dword ptr [eax*4 + 0x4324a0]
            //   c644080401           | mov                 byte ptr [eax + ecx + 4], 1
            //   57                   | push                edi
            //   e8????????           |                     

        $sequence_43 = { c7443898d4724300 8b4798 8b4804 8d41e8 89443994 }
            // n = 5, score = 100
            //   c7443898d4724300     | mov                 dword ptr [eax + edi - 0x68], 0x4372d4
            //   8b4798               | mov                 eax, dword ptr [edi - 0x68]
            //   8b4804               | mov                 ecx, dword ptr [eax + 4]
            //   8d41e8               | lea                 eax, [ecx - 0x18]
            //   89443994             | mov                 dword ptr [ecx + edi - 0x6c], eax

        $sequence_44 = { 7408 8b4510 8b4dd4 8908 8b45f8 5f }
            // n = 6, score = 100
            //   7408                 | je                  0xa
            //   8b4510               | mov                 eax, dword ptr [ebp + 0x10]
            //   8b4dd4               | mov                 ecx, dword ptr [ebp - 0x2c]
            //   8908                 | mov                 dword ptr [eax], ecx
            //   8b45f8               | mov                 eax, dword ptr [ebp - 8]
            //   5f                   | pop                 edi

        $sequence_45 = { 89542404 890424 e8???????? e8???????? a1???????? 890424 }
            // n = 6, score = 100
            //   89542404             | mov                 dword ptr [esp + 4], edx
            //   890424               | mov                 dword ptr [esp], eax
            //   e8????????           |                     
            //   e8????????           |                     
            //   a1????????           |                     
            //   890424               | mov                 dword ptr [esp], eax

        $sequence_46 = { ba???????? 8bc8 e8???????? 8d8d78baf0ff e8???????? 85c0 }
            // n = 6, score = 100
            //   ba????????           |                     
            //   8bc8                 | mov                 ecx, eax
            //   e8????????           |                     
            //   8d8d78baf0ff         | lea                 ecx, [ebp - 0xf4588]
            //   e8????????           |                     
            //   85c0                 | test                eax, eax

        $sequence_47 = { 39b880f94200 0f8491000000 ff45e4 83c030 3df0000000 }
            // n = 5, score = 100
            //   39b880f94200         | cmp                 dword ptr [eax + 0x42f980], edi
            //   0f8491000000         | je                  0x97
            //   ff45e4               | inc                 dword ptr [ebp - 0x1c]
            //   83c030               | add                 eax, 0x30
            //   3df0000000           | cmp                 eax, 0xf0

        $sequence_48 = { 83ec18 8b1d???????? 83fbff 7424 85db 740f ff149de02e4000 }
            // n = 7, score = 100
            //   83ec18               | sub                 esp, 0x18
            //   8b1d????????         |                     
            //   83fbff               | cmp                 ebx, -1
            //   7424                 | je                  0x26
            //   85db                 | test                ebx, ebx
            //   740f                 | je                  0x11
            //   ff149de02e4000       | call                dword ptr [ebx*4 + 0x402ee0]

        $sequence_49 = { 0505010000 05???????? c7442404???????? 890424 e8???????? a3???????? a1???????? }
            // n = 7, score = 100
            //   0505010000           | add                 eax, 0x105
            //   05????????           |                     
            //   c7442404????????     |                     
            //   890424               | mov                 dword ptr [esp], eax
            //   e8????????           |                     
            //   a3????????           |                     
            //   a1????????           |                     

        $sequence_50 = { e8???????? 31f6 c70002000000 eb9e e8???????? }
            // n = 5, score = 100
            //   e8????????           |                     
            //   31f6                 | xor                 esi, esi
            //   c70002000000         | mov                 dword ptr [eax], 2
            //   eb9e                 | jmp                 0xffffffa0
            //   e8????????           |                     

        $sequence_51 = { 8b35???????? 85f6 7420 6bc618 57 8db808c74300 }
            // n = 6, score = 100
            //   8b35????????         |                     
            //   85f6                 | test                esi, esi
            //   7420                 | je                  0x22
            //   6bc618               | imul                eax, esi, 0x18
            //   57                   | push                edi
            //   8db808c74300         | lea                 edi, [eax + 0x43c708]

        $sequence_52 = { e8???????? 33c0 e9???????? 8975e4 33c0 39b880f94200 }
            // n = 6, score = 100
            //   e8????????           |                     
            //   33c0                 | xor                 eax, eax
            //   e9????????           |                     
            //   8975e4               | mov                 dword ptr [ebp - 0x1c], esi
            //   33c0                 | xor                 eax, eax
            //   39b880f94200         | cmp                 dword ptr [eax + 0x42f980], edi

        $sequence_53 = { 85c0 746d eb24 a1???????? 8944240c c744240801000000 }
            // n = 6, score = 100
            //   85c0                 | test                eax, eax
            //   746d                 | je                  0x6f
            //   eb24                 | jmp                 0x26
            //   a1????????           |                     
            //   8944240c             | mov                 dword ptr [esp + 0xc], eax
            //   c744240801000000     | mov                 dword ptr [esp + 8], 1

    condition:
        7 of them and filesize < 1097728
}