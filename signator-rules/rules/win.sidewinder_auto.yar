rule win_sidewinder_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-05-16"
        version = "1"
        description = "Detects win.sidewinder."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.sidewinder"
        malpedia_rule_date = "20220513"
        malpedia_hash = "7f4b2229e6ae614d86d74917f6d5b41890e62a26"
        malpedia_version = "20220516"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 50 e8???????? 50 e8???????? 66f7d0 6689853cffffff 8d4d9c }
            // n = 7, score = 200
            //   50                   | push                eax
            //   e8????????           |                     
            //   50                   | push                eax
            //   e8????????           |                     
            //   66f7d0               | not                 ax
            //   6689853cffffff       | mov                 word ptr [ebp - 0xc4], ax
            //   8d4d9c               | lea                 ecx, [ebp - 0x64]

        $sequence_1 = { 7309 83a5a8feffff00 eb0b e8???????? 8985a8feffff 6a0a 8b45cc }
            // n = 7, score = 200
            //   7309                 | jae                 0xb
            //   83a5a8feffff00       | and                 dword ptr [ebp - 0x158], 0
            //   eb0b                 | jmp                 0xd
            //   e8????????           |                     
            //   8985a8feffff         | mov                 dword ptr [ebp - 0x158], eax
            //   6a0a                 | push                0xa
            //   8b45cc               | mov                 eax, dword ptr [ebp - 0x34]

        $sequence_2 = { ff75e8 ffb550ffffff e8???????? 898508ffffff eb07 83a508ffffff00 }
            // n = 6, score = 200
            //   ff75e8               | push                dword ptr [ebp - 0x18]
            //   ffb550ffffff         | push                dword ptr [ebp - 0xb0]
            //   e8????????           |                     
            //   898508ffffff         | mov                 dword ptr [ebp - 0xf8], eax
            //   eb07                 | jmp                 9
            //   83a508ffffff00       | and                 dword ptr [ebp - 0xf8], 0

        $sequence_3 = { 6a0d e8???????? 8945dc e8???????? 8b45dc a3???????? 8d4de8 }
            // n = 7, score = 200
            //   6a0d                 | push                0xd
            //   e8????????           |                     
            //   8945dc               | mov                 dword ptr [ebp - 0x24], eax
            //   e8????????           |                     
            //   8b45dc               | mov                 eax, dword ptr [ebp - 0x24]
            //   a3????????           |                     
            //   8d4de8               | lea                 ecx, [ebp - 0x18]

        $sequence_4 = { 81bd10ffffff09020000 7309 83a5c4feffff00 eb0b e8???????? 8985c4feffff ffb574ffffff }
            // n = 7, score = 200
            //   81bd10ffffff09020000     | cmp    dword ptr [ebp - 0xf0], 0x209
            //   7309                 | jae                 0xb
            //   83a5c4feffff00       | and                 dword ptr [ebp - 0x13c], 0
            //   eb0b                 | jmp                 0xd
            //   e8????????           |                     
            //   8985c4feffff         | mov                 dword ptr [ebp - 0x13c], eax
            //   ffb574ffffff         | push                dword ptr [ebp - 0x8c]

        $sequence_5 = { f7d8 1bc0 40 f7d8 66898570ffffff 8d45d4 50 }
            // n = 7, score = 200
            //   f7d8                 | neg                 eax
            //   1bc0                 | sbb                 eax, eax
            //   40                   | inc                 eax
            //   f7d8                 | neg                 eax
            //   66898570ffffff       | mov                 word ptr [ebp - 0x90], ax
            //   8d45d4               | lea                 eax, [ebp - 0x2c]
            //   50                   | push                eax

        $sequence_6 = { 8d4de0 e8???????? 8d45d4 50 8d45d8 50 6a02 }
            // n = 7, score = 200
            //   8d4de0               | lea                 ecx, [ebp - 0x20]
            //   e8????????           |                     
            //   8d45d4               | lea                 eax, [ebp - 0x2c]
            //   50                   | push                eax
            //   8d45d8               | lea                 eax, [ebp - 0x28]
            //   50                   | push                eax
            //   6a02                 | push                2

        $sequence_7 = { 8b00 ff75e0 ff5040 dbe2 898554ffffff 83bd54ffffff00 7d1d }
            // n = 7, score = 200
            //   8b00                 | mov                 eax, dword ptr [eax]
            //   ff75e0               | push                dword ptr [ebp - 0x20]
            //   ff5040               | call                dword ptr [eax + 0x40]
            //   dbe2                 | fnclex              
            //   898554ffffff         | mov                 dword ptr [ebp - 0xac], eax
            //   83bd54ffffff00       | cmp                 dword ptr [ebp - 0xac], 0
            //   7d1d                 | jge                 0x1f

        $sequence_8 = { 663b45c8 7f59 ff35???????? 8d45e0 50 e8???????? 0fbf45ec }
            // n = 7, score = 200
            //   663b45c8             | cmp                 ax, word ptr [ebp - 0x38]
            //   7f59                 | jg                  0x5b
            //   ff35????????         |                     
            //   8d45e0               | lea                 eax, [ebp - 0x20]
            //   50                   | push                eax
            //   e8????????           |                     
            //   0fbf45ec             | movsx               eax, word ptr [ebp - 0x14]

        $sequence_9 = { 8b45cc 898550ffffff 8d45d0 50 8b8550ffffff 8b00 ffb550ffffff }
            // n = 7, score = 200
            //   8b45cc               | mov                 eax, dword ptr [ebp - 0x34]
            //   898550ffffff         | mov                 dword ptr [ebp - 0xb0], eax
            //   8d45d0               | lea                 eax, [ebp - 0x30]
            //   50                   | push                eax
            //   8b8550ffffff         | mov                 eax, dword ptr [ebp - 0xb0]
            //   8b00                 | mov                 eax, dword ptr [eax]
            //   ffb550ffffff         | push                dword ptr [ebp - 0xb0]

    condition:
        7 of them and filesize < 679936
}