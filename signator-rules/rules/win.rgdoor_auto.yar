rule win_rgdoor_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-05-16"
        version = "1"
        description = "Detects win.rgdoor."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.rgdoor"
        malpedia_rule_date = "20220513"
        malpedia_hash = "7f4b2229e6ae614d86d74917f6d5b41890e62a26"
        malpedia_version = "20220516"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 85c0 741a 83a590000000fe 488d8de0000000 4881c198000000 e8???????? }
            // n = 6, score = 100
            //   85c0                 | and                 ecx, 0x1f
            //   741a                 | dec                 eax
            //   83a590000000fe       | imul                ecx, ecx, 0x58
            //   488d8de0000000       | dec                 eax
            //   4881c198000000       | mov                 eax, dword ptr [edx + eax*8]
            //   e8????????           |                     

        $sequence_1 = { 4803ca 4883794800 7503 83c804 4533c0 8bd0 }
            // n = 6, score = 100
            //   4803ca               | dec                 eax
            //   4883794800           | or                  ebx, 0xffffffff
            //   7503                 | dec                 eax
            //   83c804               | inc                 ebx
            //   4533c0               | cmp                 byte ptr [edx + ebx], 0
            //   8bd0                 | jne                 0xfcf

        $sequence_2 = { b900800000 3c62 440f44c1 410fbae807 ba00040000 }
            // n = 5, score = 100
            //   b900800000           | test                eax, eax
            //   3c62                 | dec                 eax
            //   440f44c1             | lea                 edx, [0x245d8]
            //   410fbae807           | jmp                 0x5de
            //   ba00040000           | dec                 eax

        $sequence_3 = { 4053 4883ec20 488b4108 488bd9 4885c0 7410 488d0d23c20200 }
            // n = 7, score = 100
            //   4053                 | pop                 edi
            //   4883ec20             | ret                 
            //   488b4108             | dec                 eax
            //   488bd9               | mov                 dword ptr [esp + 8], ebx
            //   4885c0               | push                edi
            //   7410                 | dec                 eax
            //   488d0d23c20200       | sub                 esp, 0x20

        $sequence_4 = { c705????????01000000 c705????????01000000 b808000000 486bc000 488d0dca980200 8b542430 }
            // n = 6, score = 100
            //   c705????????01000000     |     
            //   c705????????01000000     |     
            //   b808000000           | dec                 eax
            //   486bc000             | lea                 esi, [ecx - 0x98]
            //   488d0dca980200       | mov                 edi, edx
            //   8b542430             | dec                 eax

        $sequence_5 = { 4c8d0dcc8c0200 4c8d1de5b10200 4c63d0 458d4202 }
            // n = 4, score = 100
            //   4c8d0dcc8c0200       | mov                 ebp, ebx
            //   4c8d1de5b10200       | jmp                 0x98a
            //   4c63d0               | mov                 al, byte ptr [ebx]
            //   458d4202             | test                al, al

        $sequence_6 = { 742d 4c8d053ea10100 ba04010000 488bce e8???????? 85c0 }
            // n = 6, score = 100
            //   742d                 | call                dword ptr [eax + 0x50]
            //   4c8d053ea10100       | dec                 eax
            //   ba04010000           | mov                 eax, dword ptr [ecx]
            //   488bce               | call                dword ptr [eax + 8]
            //   e8????????           |                     
            //   85c0                 | nop                 

        $sequence_7 = { 8bc8 e8???????? 4883cbff 895c2438 488bcf ff15???????? 4885f6 }
            // n = 7, score = 100
            //   8bc8                 | mov                 edx, 0x5c
            //   e8????????           |                     
            //   4883cbff             | dec                 eax
            //   895c2438             | mov                 ecx, esi
            //   488bcf               | dec                 eax
            //   ff15????????         |                     
            //   4885f6               | lea                 esi, [ebp - 0x3c]

        $sequence_8 = { 8b4c8450 e8???????? 90 b909000000 e8???????? }
            // n = 5, score = 100
            //   8b4c8450             | dec                 eax
            //   e8????????           |                     
            //   90                   | lea                 ecx, [0x114f2]
            //   b909000000           | dec                 eax
            //   e8????????           |                     

        $sequence_9 = { 488905???????? 488d050ea50000 488905???????? 488d0560a40000 488905???????? }
            // n = 5, score = 100
            //   488905????????       |                     
            //   488d050ea50000       | lea                 ecx, [0x229d8]
            //   488905????????       |                     
            //   488d0560a40000       | inc                 ecx
            //   488905????????       |                     

    condition:
        7 of them and filesize < 475136
}