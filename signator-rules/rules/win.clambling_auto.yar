rule win_clambling_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-05-16"
        version = "1"
        description = "Detects win.clambling."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.clambling"
        malpedia_rule_date = "20220513"
        malpedia_hash = "7f4b2229e6ae614d86d74917f6d5b41890e62a26"
        malpedia_version = "20220516"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 418d4802 498943f0 ff15???????? 85c0 }
            // n = 4, score = 300
            //   418d4802             | cmp                 eax, 5
            //   498943f0             | ja                  0xa74
            //   ff15????????         |                     
            //   85c0                 | inc                 ecx

        $sequence_1 = { 498bf8 488bf1 4885c0 7525 }
            // n = 4, score = 300
            //   498bf8               | mov                 edx, esp
            //   488bf1               | call                dword ptr [eax]
            //   4885c0               | dec                 eax
            //   7525                 | and                 dword ptr [edi], 0

        $sequence_2 = { ff15???????? 85c0 7426 8b442450 83f801 7419 }
            // n = 6, score = 300
            //   ff15????????         |                     
            //   85c0                 | inc                 esp
            //   7426                 | mov                 dword ptr [ebx + 0x142b0], esp
            //   8b442450             | inc                 esp
            //   83f801               | mov                 dword ptr [ebx + 0x142ac], esp
            //   7419                 | mov                 dword ptr [ebx + 0x192ec], ebp

        $sequence_3 = { 893d???????? ff15???????? 3bc7 7507 66893d???????? }
            // n = 5, score = 300
            //   893d????????         |                     
            //   ff15????????         |                     
            //   3bc7                 | arpl                bx, dx
            //   7507                 | dec                 eax
            //   66893d????????       |                     

        $sequence_4 = { 6644899c2410030000 6689842412030000 ff15???????? 8b942410030000 488bc8 }
            // n = 5, score = 300
            //   6644899c2410030000     | xor    ebx, ebx
            //   6689842412030000     | inc                 esp
            //   ff15????????         |                     
            //   8b942410030000       | lea                 ecx, [esi + 1]
            //   488bc8               | inc                 ecx

        $sequence_5 = { 488bce ff15???????? 440fb75c2440 66453bdd 7f0b 0fb7442442 }
            // n = 6, score = 300
            //   488bce               | jne                 0x102a
            //   ff15????????         |                     
            //   440fb75c2440         | cmp                 word ptr [esp + 0x260], si
            //   66453bdd             | je                  0x107b
            //   7f0b                 | dec                 esp
            //   0fb7442442           | lea                 ecx, [esp + 0x25c]

        $sequence_6 = { 33ff 897c2430 ff15???????? 483905???????? 7510 813d????????f8010000 }
            // n = 6, score = 300
            //   33ff                 | mov                 ecx, 0x80000001
            //   897c2430             | mov                 dword ptr [esp + 0x28], ebx
            //   ff15????????         |                     
            //   483905????????       |                     
            //   7510                 | inc                 esp
            //   813d????????f8010000     |     

        $sequence_7 = { e8???????? ebb8 8b742428 483bfb 7409 488bcf }
            // n = 6, score = 300
            //   e8????????           |                     
            //   ebb8                 | dec                 ebp
            //   8b742428             | mov                 edi, ecx
            //   483bfb               | mov                 edx, dword ptr [ebx + 4]
            //   7409                 | dec                 eax
            //   488bcf               | lea                 ecx, [ebx + 8]

        $sequence_8 = { 7507 66893d???????? 488b0d???????? 488d542430 ff15???????? 448b442430 }
            // n = 6, score = 300
            //   7507                 | mov                 dword ptr [ebx], esi
            //   66893d????????       |                     
            //   488b0d????????       |                     
            //   488d542430           | dec                 eax
            //   ff15????????         |                     
            //   448b442430           | mov                 dword ptr [ebx + 0xd0], esi

        $sequence_9 = { ff15???????? 3bc7 7507 66893d???????? }
            // n = 4, score = 300
            //   ff15????????         |                     
            //   3bc7                 | dec                 eax
            //   7507                 | mov                 edx, edi
            //   66893d????????       |                     

    condition:
        7 of them and filesize < 412672
}