rule win_poslurp_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-05-16"
        version = "1"
        description = "Detects win.poslurp."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.poslurp"
        malpedia_rule_date = "20220513"
        malpedia_hash = "7f4b2229e6ae614d86d74917f6d5b41890e62a26"
        malpedia_version = "20220516"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 0bd0 440bca 4983eb01 75cc 488d1515400000 0f1f440000 418bc0 }
            // n = 7, score = 100
            //   0bd0                 | je                  0x100
            //   440bca               | mov                 ecx, dword ptr [esi]
            //   4983eb01             | test                ecx, ecx
            //   75cc                 | inc                 esp
            //   488d1515400000       | or                  ecx, edx
            //   0f1f440000           | dec                 ecx
            //   418bc0               | sub                 ebx, 1

        $sequence_1 = { 8bc8 2bcd 83c1dc 83f93c 0f87d4000000 8078103d 0f85ca000000 }
            // n = 7, score = 100
            //   8bc8                 | ja                  0x7e6
            //   2bcd                 | dec                 ebp
            //   83c1dc               | test                esp, esp
            //   83f93c               | test                edx, edx
            //   0f87d4000000         | jne                 0x76e
            //   8078103d             | lea                 eax, [edi - 0xf]
            //   0f85ca000000         | cmp                 eax, 5

        $sequence_2 = { ba00000040 c744242802000000 c744242004000000 ff15???????? 488bd8 4883f8ff }
            // n = 6, score = 100
            //   ba00000040           | mov                 dword ptr [esp + 0x20], 0x40
            //   c744242802000000     | dec                 eax
            //   c744242004000000     | mov                 ebp, eax
            //   ff15????????         |                     
            //   488bd8               | xor                 edx, edx
            //   4883f8ff             | dec                 eax

        $sequence_3 = { 0f84b6000000 660f1f440000 0fbe06 ffc9 83e830 }
            // n = 5, score = 100
            //   0f84b6000000         | mov                 word ptr [esp + edx*2 + 0x20], ax
            //   660f1f440000         | inc                 ecx
            //   0fbe06               | inc                 eax
            //   ffc9                 | dec                 eax
            //   83e830               | inc                 edx

        $sequence_4 = { 488bd8 4883f8ff 743d 448d4f02 4533c0 33d2 488bc8 }
            // n = 7, score = 100
            //   488bd8               | mov                 dword ptr [esp + 0x40], eax
            //   4883f8ff             | dec                 eax
            //   743d                 | lea                 eax, [esp + 0x98]
            //   448d4f02             | dec                 eax
            //   4533c0               | mov                 edx, ebp
            //   33d2                 | dec                 eax
            //   488bc8               | mov                 ecx, edi

        $sequence_5 = { ff15???????? cc 4c8b0d???????? 4883c9ff }
            // n = 4, score = 100
            //   ff15????????         |                     
            //   cc                   | inc                 edi
            //   4c8b0d????????       |                     
            //   4883c9ff             | dec                 ebp

        $sequence_6 = { 458b0491 4433c0 83c7ff 75df 8b15???????? }
            // n = 5, score = 100
            //   458b0491             | mov                 edi, ebx
            //   4433c0               | test                ecx, ecx
            //   83c7ff               | je                  0xb3
            //   75df                 | movzx               eax, word ptr [edx]
            //   8b15????????         |                     

        $sequence_7 = { 7409 4881eb00100000 ebec 488bcb e8???????? 488bcb }
            // n = 6, score = 100
            //   7409                 | dec                 eax
            //   4881eb00100000       | lea                 ecx, [esp + 0x50]
            //   ebec                 | dec                 ecx
            //   488bcb               | mov                 edx, esi
            //   e8????????           |                     
            //   488bcb               | dec                 eax

        $sequence_8 = { 498bcd 488d542450 4533c9 f3aa 488d842480000000 4533c0 4889442448 }
            // n = 7, score = 100
            //   498bcd               | mov                 eax, ecx
            //   488d542450           | dec                 esp
            //   4533c9               | add                 eax, ecx
            //   f3aa                 | inc                 ecx
            //   488d842480000000     | mov                 edx, dword ptr [eax]
            //   4533c0               | xor                 ecx, ecx
            //   4889442448           | dec                 ecx

        $sequence_9 = { 498bc1 660f1f440000 443900 7434 ffc1 4883c004 3bca }
            // n = 7, score = 100
            //   498bc1               | inc                 edi
            //   660f1f440000         | dec                 ebp
            //   443900               | cmp                 edi, esi
            //   7434                 | jb                  0x1d4
            //   ffc1                 | dec                 esp
            //   4883c004             | lea                 ebx, [esp + 0x60]
            //   3bca                 | dec                 ecx

    condition:
        7 of them and filesize < 50176
}