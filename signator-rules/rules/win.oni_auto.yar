rule win_oni_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-05-16"
        version = "1"
        description = "Detects win.oni."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.oni"
        malpedia_rule_date = "20220513"
        malpedia_hash = "7f4b2229e6ae614d86d74917f6d5b41890e62a26"
        malpedia_version = "20220516"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 3bc7 0f8394000000 2bf8 83ff04 0f828e000000 83ff23 0f878a000000 }
            // n = 7, score = 200
            //   3bc7                 | cmp                 eax, edi
            //   0f8394000000         | jae                 0x9a
            //   2bf8                 | sub                 edi, eax
            //   83ff04               | cmp                 edi, 4
            //   0f828e000000         | jb                  0x94
            //   83ff23               | cmp                 edi, 0x23
            //   0f878a000000         | ja                  0x90

        $sequence_1 = { 2bbd7cffffff 83fa10 723e 8d4201 3d00100000 722b f645801f }
            // n = 7, score = 200
            //   2bbd7cffffff         | sub                 edi, dword ptr [ebp - 0x84]
            //   83fa10               | cmp                 edx, 0x10
            //   723e                 | jb                  0x40
            //   8d4201               | lea                 eax, [edx + 1]
            //   3d00100000           | cmp                 eax, 0x1000
            //   722b                 | jb                  0x2d
            //   f645801f             | test                byte ptr [ebp - 0x80], 0x1f

        $sequence_2 = { 83f904 0f8203010000 83f923 0f87ff000000 }
            // n = 4, score = 200
            //   83f904               | cmp                 ecx, 4
            //   0f8203010000         | jb                  0x109
            //   83f923               | cmp                 ecx, 0x23
            //   0f87ff000000         | ja                  0x105

        $sequence_3 = { 25fe010000 f20f593c8530ed4200 660f122c8530ed4200 03c0 660f28348540f14200 ba7f3e0400 e9???????? }
            // n = 7, score = 200
            //   25fe010000           | and                 eax, 0x1fe
            //   f20f593c8530ed4200     | mulsd    xmm7, qword ptr [eax*4 + 0x42ed30]
            //   660f122c8530ed4200     | movlpd    xmm5, qword ptr [eax*4 + 0x42ed30]
            //   03c0                 | add                 eax, eax
            //   660f28348540f14200     | movapd    xmm6, xmmword ptr [eax*4 + 0x42f140]
            //   ba7f3e0400           | mov                 edx, 0x43e7f
            //   e9????????           |                     

        $sequence_4 = { 8be5 5d c3 0f57c0 c745dc487e4200 68???????? 8d45dc }
            // n = 7, score = 200
            //   8be5                 | mov                 esp, ebp
            //   5d                   | pop                 ebp
            //   c3                   | ret                 
            //   0f57c0               | xorps               xmm0, xmm0
            //   c745dc487e4200       | mov                 dword ptr [ebp - 0x24], 0x427e48
            //   68????????           |                     
            //   8d45dc               | lea                 eax, [ebp - 0x24]

        $sequence_5 = { 736e 2bf8 83ff04 726c 83ff23 776c 8bf8 }
            // n = 7, score = 200
            //   736e                 | jae                 0x70
            //   2bf8                 | sub                 edi, eax
            //   83ff04               | cmp                 edi, 4
            //   726c                 | jb                  0x6e
            //   83ff23               | cmp                 edi, 0x23
            //   776c                 | ja                  0x6e
            //   8bf8                 | mov                 edi, eax

        $sequence_6 = { 723e 8d4201 3d00100000 722b f645801f 0f85a5020000 }
            // n = 6, score = 200
            //   723e                 | jb                  0x40
            //   8d4201               | lea                 eax, [edx + 1]
            //   3d00100000           | cmp                 eax, 0x1000
            //   722b                 | jb                  0x2d
            //   f645801f             | test                byte ptr [ebp - 0x80], 0x1f
            //   0f85a5020000         | jne                 0x2ab

        $sequence_7 = { 6a1e 8d45dc 50 ff15???????? 668b45dc 668985d4feffff 80bdd4feffff00 }
            // n = 7, score = 200
            //   6a1e                 | push                0x1e
            //   8d45dc               | lea                 eax, [ebp - 0x24]
            //   50                   | push                eax
            //   ff15????????         |                     
            //   668b45dc             | mov                 ax, word ptr [ebp - 0x24]
            //   668985d4feffff       | mov                 word ptr [ebp - 0x12c], ax
            //   80bdd4feffff00       | cmp                 byte ptr [ebp - 0x12c], 0

        $sequence_8 = { 3bd0 0f47ce 85c9 7423 8b5dc0 8bf9 0fbe0416 }
            // n = 7, score = 200
            //   3bd0                 | cmp                 edx, eax
            //   0f47ce               | cmova               ecx, esi
            //   85c9                 | test                ecx, ecx
            //   7423                 | je                  0x25
            //   8b5dc0               | mov                 ebx, dword ptr [ebp - 0x40]
            //   8bf9                 | mov                 edi, ecx
            //   0fbe0416             | movsx               eax, byte ptr [esi + edx]

        $sequence_9 = { 8bec 53 56 57 6a01 51 8bf1 }
            // n = 7, score = 200
            //   8bec                 | mov                 ebp, esp
            //   53                   | push                ebx
            //   56                   | push                esi
            //   57                   | push                edi
            //   6a01                 | push                1
            //   51                   | push                ecx
            //   8bf1                 | mov                 esi, ecx

    condition:
        7 of them and filesize < 499712
}