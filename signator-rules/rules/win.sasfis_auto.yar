rule win_sasfis_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-05-16"
        version = "1"
        description = "Detects win.sasfis."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.sasfis"
        malpedia_rule_date = "20220513"
        malpedia_hash = "7f4b2229e6ae614d86d74917f6d5b41890e62a26"
        malpedia_version = "20220516"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 66ffc7 c744241400000000 660facff03 660fcf 8b742440 660fbae30a 660fbafd04 }
            // n = 7, score = 100
            //   66ffc7               | inc                 di
            //   c744241400000000     | mov                 dword ptr [esp + 0x14], 0
            //   660facff03           | shrd                di, di, 3
            //   660fcf               | bswap               di
            //   8b742440             | mov                 esi, dword ptr [esp + 0x40]
            //   660fbae30a           | bt                  bx, 0xa
            //   660fbafd04           | btc                 bp, 4

        $sequence_1 = { 8d642428 e9???????? e8???????? ff74240c 8f4500 55 66c70424c279 }
            // n = 7, score = 100
            //   8d642428             | lea                 esp, [esp + 0x28]
            //   e9????????           |                     
            //   e8????????           |                     
            //   ff74240c             | push                dword ptr [esp + 0xc]
            //   8f4500               | pop                 dword ptr [ebp]
            //   55                   | push                ebp
            //   66c70424c279         | mov                 word ptr [esp], 0x79c2

        $sequence_2 = { 8d6c2424 ff742408 80fd7b 81cf73a6238d 81ec98000000 }
            // n = 5, score = 100
            //   8d6c2424             | lea                 ebp, [esp + 0x24]
            //   ff742408             | push                dword ptr [esp + 8]
            //   80fd7b               | cmp                 ch, 0x7b
            //   81cf73a6238d         | or                  edi, 0x8d23a673
            //   81ec98000000         | sub                 esp, 0x98

        $sequence_3 = { c41f 2b6855 b96420a46d b260 d3648c9a }
            // n = 5, score = 100
            //   c41f                 | les                 ebx, ptr [edi]
            //   2b6855               | sub                 ebp, dword ptr [eax + 0x55]
            //   b96420a46d           | mov                 ecx, 0x6da42064
            //   b260                 | mov                 dl, 0x60
            //   d3648c9a             | shl                 dword ptr [esp + ecx*4 - 0x66], cl

        $sequence_4 = { 8c26 10142d1d012139 1535193d0d 0511600038 1030 0800 3c20 }
            // n = 7, score = 100
            //   8c26                 | mov                 word ptr [esi], fs
            //   10142d1d012139       | adc                 byte ptr [ebp + 0x3921011d], dl
            //   1535193d0d           | adc                 eax, 0xd3d1935
            //   0511600038           | add                 eax, 0x38006011
            //   1030                 | adc                 byte ptr [eax], dh
            //   0800                 | or                  byte ptr [eax], al
            //   3c20                 | cmp                 al, 0x20

        $sequence_5 = { ea???????????? c9 63fc 3e5a }
            // n = 4, score = 100
            //   ea????????????       |                     
            //   c9                   | leave               
            //   63fc                 | arpl                sp, di
            //   3e5a                 | pop                 edx

        $sequence_6 = { 9c 66ffc9 8a2c24 0fb6c0 }
            // n = 4, score = 100
            //   9c                   | pushfd              
            //   66ffc9               | dec                 cx
            //   8a2c24               | mov                 ch, byte ptr [esp]
            //   0fb6c0               | movzx               eax, al

        $sequence_7 = { 0011 006188 c52b 3903 3c00 7d3f }
            // n = 6, score = 100
            //   0011                 | add                 byte ptr [ecx], dl
            //   006188               | add                 byte ptr [ecx - 0x78], ah
            //   c52b                 | lds                 ebp, ptr [ebx]
            //   3903                 | cmp                 dword ptr [ebx], eax
            //   3c00                 | cmp                 al, 0
            //   7d3f                 | jge                 0x41

        $sequence_8 = { 692667724f77 260330 0c16 7845 b320 3c10 }
            // n = 6, score = 100
            //   692667724f77         | imul                esp, dword ptr [esi], 0x774f7267
            //   260330               | add                 esi, dword ptr es:[eax]
            //   0c16                 | or                  al, 0x16
            //   7845                 | js                  0x47
            //   b320                 | mov                 bl, 0x20
            //   3c10                 | cmp                 al, 0x10

        $sequence_9 = { 652661 54 676c 260c52 }
            // n = 4, score = 100
            //   652661               | popal               
            //   54                   | push                esp
            //   676c                 | insb                byte ptr es:[di], dx
            //   260c52               | or                  al, 0x52

    condition:
        7 of them and filesize < 8060928
}